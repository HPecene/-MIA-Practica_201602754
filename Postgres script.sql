CREATE TABLE PROFESION
( cod_prof INTEGER NOT NULL PRIMARY KEY,
  nombre VARCHAR(50) UNIQUE NOT NULL
);

CREATE TABLE PAIS
( cod_pais INTEGER NOT NULL PRIMARY KEY,
  nombre VARCHAR(50) UNIQUE NOT NULL
);

CREATE TABLE PUESTO
( cod_puesto INTEGER NOT NULL PRIMARY KEY,
  nombre VARCHAR(50) NOT NULL UNIQUE
);

CREATE TABLE DEPARTAMENTO
( cod_depto INTEGER NOT NULL PRIMARY KEY,
  nombre VARCHAR(50) UNIQUE NOT NULL 
);

CREATE TABLE MIEMBRO
( cod_miembro INTEGER NOT NULL PRIMARY KEY,
  nombre VARCHAR(100) NOT NULL,
  apellido VARCHAR(100) NOT NULL,
  edad INTEGER NOT NULL,
  telefono INTEGER,
  residencia VARCHAR(100),
  PAIS_cod_pais INTEGER NOT NULL,
  PROFESION_cod_prof INTEGER NOT NULL,
  FOREIGN KEY (PAIS_cod_pais) REFERENCES PAIS(cod_pais),
  FOREIGN KEY (PROFESION_cod_prof) REFERENCES PROFESION(cod_prof)
);

CREATE TABLE PUESTO_MIEMBRO
( MIEMBRO_cod_miembro INTEGER NOT NULL,
  PUESTO_cod_puesto INTEGER NOT NULL,
  DEPARTAMENTO_cod_depto INTEGER NOT NULL,
  fecha_inicio DATE NOT NULL,
  fecha_fin DATE,
  FOREIGN KEY (MIEMBRO_cod_miembro) REFERENCES MIEMBRO(cod_miembro),
  FOREIGN KEY (PUESTO_cod_puesto) REFERENCES PUESTO(cod_puesto),
  FOREIGN KEY (DEPARTAMENTO_cod_depto) REFERENCES DEPARTAMENTO(cod_depto),
  CONSTRAINT PK_PUESTO_MIEMBRO PRIMARY KEY (MIEMBRO_cod_miembro,PUESTO_cod_puesto,DEPARTAMENTO_cod_depto)
);

CREATE TABLE TIPO_MEDALLA
( cod_tipo INTEGER NOT NULL PRIMARY KEY,
  medalla VARCHAR(20) UNIQUE NOT NULL 
);

CREATE TABLE MEDALLERO
( PAIS_cod_pais INTEGER NOT NULL,
  cantidad_medallas INTEGER NOT NULL,
  TIPO_MEDALLA_cod_tipo INTEGER NOT NULL,
  FOREIGN KEY (PAIS_cod_pais) REFERENCES PAIS(cod_pais),
  FOREIGN KEY (TIPO_MEDALLA_cod_tipo) REFERENCES TIPO_MEDALLA(cod_tipo) ON DELETE CASCADE,
  CONSTRAINT PK_MEDALLERO PRIMARY KEY (PAIS_cod_pais,TIPO_MEDALLA_cod_tipo)
);

CREATE TABLE DISCIPLINA
( cod_disciplina INTEGER NOT NULL PRIMARY KEY,
  nombre VARCHAR(50) NOT NULL,
  descripcion VARCHAR(150)
);

CREATE TABLE ATLETA
( cod_atleta INTEGER NOT NULL PRIMARY KEY,
  nombre VARCHAR(50) NOT NULL,
  apellido VARCHAR(50) NOT NULL,
  edad INTEGER NOT NULL,
  participaciones VARCHAR(100) NOT NULL,
  DISCIPLINA_cod_disciplina INTEGER NOT NULL,
  PAIS_cod_pais INTEGER NOT NULL,
  FOREIGN KEY (DISCIPLINA_cod_disciplina) REFERENCES DISCIPLINA(cod_disciplina) ON DELETE CASCADE,
  FOREIGN KEY (PAIS_cod_pais) REFERENCES PAIS(cod_pais)
);

CREATE TABLE CATEGORIA
( cod_categoria INTEGER NOT NULL PRIMARY KEY,
  categoria VARCHAR(50) NOT NULL
);

CREATE TABLE TIPO_PARTICIPACION
( cod_participacion INTEGER NOT NULL PRIMARY KEY,
  tipo_participacion VARCHAR(100) NOT NULL
);

CREATE TABLE EVENTO
( cod_evento INTEGER NOT NULL PRIMARY KEY,
  fecha DATE NOT NULL,
  hora DATE NOT NULL,
  ubicacion VARCHAR(150) NOT NULL,
  DISCIPLINA_cod_disciplina INTEGER NOT NULL,
  TIPO_PARTICIPACION_cod_participacion INTEGER NOT NULL,
  CATEGORIA_cod_categoria INTEGER NOT NULL,
  FOREIGN KEY (DISCIPLINA_cod_disciplina) REFERENCES DISCIPLINA(cod_disciplina) ON DELETE CASCADE,
  FOREIGN KEY (TIPO_PARTICIPACION_cod_participacion) REFERENCES TIPO_PARTICIPACION(cod_participacion),
  FOREIGN KEY (CATEGORIA_cod_categoria)REFERENCES CATEGORIA(cod_categoria)
);

CREATE TABLE EVENTO_ATLETA
( ATLETA_cod_atleta INTEGER NOT NULL,
  EVENTO_cod_evento INTEGER NOT NULL,
  FOREIGN KEY (ATLETA_cod_atleta) REFERENCES ATLETA(cod_atleta),
  FOREIGN KEY (EVENTO_cod_evento) REFERENCES EVENTO(cod_evento),
  CONSTRAINT PK_EVENTO_ATLETA PRIMARY KEY (ATLETA_cod_atleta,EVENTO_cod_evento)
);

CREATE TABLE TELEVISORA
( cod_televisora INTEGER NOT NULL PRIMARY KEY,
  nombre VARCHAR(50) NOT NULL
);

CREATE TABLE COSTO_EVENTO
( EVENTO_cod_evento INTEGER NOT NULL,
  TELEVISORA_cod_televisora INTEGER NOT NULL,
  tarifa NUMERIC NOT NULL,
  FOREIGN KEY (EVENTO_cod_evento) REFERENCES EVENTO(cod_evento),
  FOREIGN KEY (TELEVISORA_cod_televisora) REFERENCES TELEVISORA(cod_televisora),
  CONSTRAINT PK_COSTO_EVENTO PRIMARY KEY (EVENTO_cod_evento,TELEVISORA_cod_televisora)
);

ALTER TABLE EVENTO DROP COLUMN fecha;
ALTER TABLE EVENTO DROP COLUMN hora;
ALTER TABLE EVENTO ADD COLUMN fecha_hora TIMESTAMP NOT NULL;

ALTER TABLE EVENTO ADD CONSTRAINT fecha_hora CHECK (fecha_hora>to_timestamp('2020-07-24 09:00:00', 'YYYY-MM-DD:HH24:MI:SS') AND fecha_hora<to_timestamp('2020-08-09 20:00:00', 'YYYY-MM-DD:HH24:MI:SS'));

CREATE TABLE SEDE
( codigo INTEGER NOT NULL PRIMARY KEY,
  sede VARCHAR(50) NOT NULL
);

ALTER TABLE EVENTO DROP COLUMN ubicacion;
ALTER TABLE EVENTO ADD COLUMN ubicacion INTEGER NOT NULL;
ALTER TABLE EVENTO
ADD FOREIGN KEY (ubicacion) REFERENCES SEDE(codigo); 

ALTER TABLE MIEMBRO DROP COLUMN telefono;
ALTER TABLE MIEMBRO ADD COLUMN telefono INTEGER DEFAULT 0;

INSERT INTO PAIS VALUES (1, 'Guatemala');
INSERT INTO PAIS VALUES (2, 'Francia');
INSERT INTO PAIS VALUES (3, 'Argentina');
INSERT INTO PAIS VALUES (4, 'Alemania');
INSERT INTO PAIS VALUES (5, 'Italia');
INSERT INTO PAIS VALUES (6, 'Brasil');
INSERT INTO PAIS VALUES (7, 'Estados Unidos');

INSERT INTO PROFESION VALUES (1, 'Medico');
INSERT INTO PROFESION VALUES (2, 'Arquitecto');
INSERT INTO PROFESION VALUES (3, 'Ingeniero');
INSERT INTO PROFESION VALUES (4, 'Secretaria');
INSERT INTO PROFESION VALUES (5, 'Auditor');

INSERT INTO MIEMBRO VALUES (1, 'Scott','Mitchell',32,'1092 Highland Drive Manitowoc, WI 54220',7,3, DEFAULT);
INSERT INTO MIEMBRO VALUES (2, 'Fanette','Poulin',25,'49, boulevard Aristide Briand 76120 LE GRAND-QUEVILLY',2,4, 25075853);
INSERT INTO MIEMBRO VALUES (3, 'Laura','Cunha Silva',55,'Rua Onze, 86 Uberaba-MG',6,5, DEFAULT);
INSERT INTO MIEMBRO VALUES (4, 'Juan Jose','Lopez',38,'26 calle 4-10 zona 11',1,2,36985247);
INSERT INTO MIEMBRO VALUES (5, 'Arcangela','Panicucci',39,'Via Santa Teresa, 114 90010-Geraci Siculo PA',5,1,391664921);
INSERT INTO MIEMBRO VALUES (6, 'Jeuel','Villalpando',31,'Acuna de Figeroa 6106 80101 Playa Pascual',3,5, DEFAULT);

INSERT INTO DISCIPLINA VALUES (1, 'Atletismo', 'Saltos de longitud y triples, de altura y con pertiga o garrocha; las pruebas de lanzamiento de martillo, jabalina y disco.');
INSERT INTO DISCIPLINA VALUES (2, 'Badminton', '');
INSERT INTO DISCIPLINA VALUES (3, 'Ciclismo', '');
INSERT INTO DISCIPLINA VALUES (4, 'Judo', 'Es un arte marcial que se origino en Japon alrededor de 1880');
INSERT INTO DISCIPLINA VALUES (5, 'Lucha', '');
INSERT INTO DISCIPLINA VALUES (6, 'Tenis de Mesa', '');
INSERT INTO DISCIPLINA VALUES (7, 'Boxeo', '');
INSERT INTO DISCIPLINA VALUES (8, 'Natacion', 'Esta presente como deporte en los Juegos desde la primera edicion de la era moderna, en Atenas, Grecia, en 1896, donde se disputo en aguas abiertas.');
INSERT INTO DISCIPLINA VALUES (9, 'Esgrima', '');
INSERT INTO DISCIPLINA VALUES (10, 'Vela', '');

INSERT INTO TIPO_MEDALLA VALUES (1,'Oro');
INSERT INTO TIPO_MEDALLA VALUES (2,'Plata');
INSERT INTO TIPO_MEDALLA VALUES (3,'Bronce');
INSERT INTO TIPO_MEDALLA VALUES (4,'Platino');

INSERT INTO CATEGORIA VALUES (1,'Clasificatorio');
INSERT INTO CATEGORIA VALUES (2,'Eliminatorio');
INSERT INTO CATEGORIA VALUES (3,'Final');

INSERT INTO TIPO_PARTICIPACION VALUES (1,'Individual');
INSERT INTO TIPO_PARTICIPACION VALUES (2,'Parejas');
INSERT INTO TIPO_PARTICIPACION VALUES (3,'Equipos');

INSERT INTO MEDALLERO VALUES (5,3,1);
INSERT INTO MEDALLERO VALUES (2,5,1);
INSERT INTO MEDALLERO VALUES (6,4,3);
INSERT INTO MEDALLERO VALUES (4,3,4);
INSERT INTO MEDALLERO VALUES (7,10,3);
INSERT INTO MEDALLERO VALUES (3,8,2);
INSERT INTO MEDALLERO VALUES (1,2,1);
INSERT INTO MEDALLERO VALUES (1,5,4);
INSERT INTO MEDALLERO VALUES (5,7,2);

INSERT INTO SEDE VALUES (1,'Gimnasio Metropolitano de Tokio');
INSERT INTO SEDE VALUES (2,'Jardin del Palacio Imperial de Tokio');
INSERT INTO SEDE VALUES (3,'Gimnasio Nacional Yoyogi');
INSERT INTO SEDE VALUES (4,'Nippon Budokan');
INSERT INTO SEDE VALUES (5,'Estadio Olimpico');

INSERT INTO EVENTO VALUES (1,2,2,1, to_timestamp('2020-07-24 11:00:00', 'YYYY-MM-DD:HH24:MI:SS'),3);
INSERT INTO EVENTO VALUES (2,6,1,3,to_timestamp('2020-07-26 10:30:00', 'YYYY-MM-DD:HH24:MI:SS'),1);
INSERT INTO EVENTO VALUES (3,7,1,2,to_timestamp('2020-07-30 18:45:00', 'YYYY-MM-DD:HH24:MI:SS'),5);
INSERT INTO EVENTO VALUES (4,1,1,1,to_timestamp('2020-08-01 12:15:00', 'YYYY-MM-DD:HH24:MI:SS'),2);
INSERT INTO EVENTO VALUES (5,10,3,1,to_timestamp('2020-08-08 19:35:00', 'YYYY-MM-DD:HH24:MI:SS'),4);

ALTER TABLE PAIS DROP CONSTRAINT pais_nombre_key;
ALTER TABLE TIPO_MEDALLA DROP CONSTRAINT tipo_medalla_medalla_key;
ALTER TABLE DEPARTAMENTO DROP CONSTRAINT departamento_nombre_key;

ALTER TABLE ATLETA DROP COLUMN DISCIPLINA_cod_disciplina;
CREATE TABLE DISCIPLINA_ATLETA
( ATLETA_cod_atleta INTEGER NOT NULL,
  DISCIPLINA_cod_disciplina INTEGER NOT NULL,
  FOREIGN KEY (ATLETA_cod_atleta) REFERENCES ATLETA(cod_atleta),
  FOREIGN KEY (DISCIPLINA_cod_disciplina) REFERENCES DISCIPLINA(cod_disciplina),
  CONSTRAINT PK_DISCIPLINA_ATLETA PRIMARY KEY (ATLETA_cod_atleta,DISCIPLINA_cod_disciplina)
);

ALTER TABLE COSTO_EVENTO ALTER COLUMN tarifa TYPE NUMERIC(8,2);
	
DELETE FROM TIPO_MEDALLA WHERE cod_tipo = 4;

DROP TABLE COSTO_EVENTO; 
DROP TABLE TELEVISORA; 

DELETE FROM DISCIPLINA;

UPDATE MIEMBRO SET telefono = 55464601 WHERE nombre = 'Laura' AND apellido = 'Cunha Silva';
UPDATE MIEMBRO SET telefono = 91514243 WHERE nombre = 'Jeuel' AND apellido = 'Villalpando';
UPDATE MIEMBRO SET telefono = 920686670 WHERE nombre = 'Scott' AND apellido = 'Mitchell';

ALTER TABLE ATLETA ADD COLUMN fotografia BYTEA;

ALTER TABLE ATLETA ADD CONSTRAINT edad CHECK (edad < 25);
